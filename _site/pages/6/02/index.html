<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Packet Analysis · Game Hacking Academy</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Game hacking tutorials and lessons.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="attilathedud"><link rel="stylesheet" href="/assets/gitbook/style.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">

<link rel="stylesheet" href="/assets/gitbook/rouge/base16.css">

<link rel="stylesheet" href="/assets/gitbook/custom.css">
<link rel="stylesheet" href="/assets/gitbook/custom-local.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">

<script src="/assets/particles.min.js"></script>

<style>
    @media screen and (min-width: 1101px) {
      .eyecandy {
        position: fixed;
        bottom: 0;
        right: 0;
        min-height: 50%;
        height: 50%;
        width: 25%;
        pointer-events: none;
        z-index: 1;
      }
    }
    @media screen and (max-width: 1100px) {
      .eyecandy {
        display: none;
      }
    }
  </style>






    <link rel="prev" href="/pages/6/01/" />
     
    <link rel="next" href="/pages/6/03/" />
    
    
  </head>
  <body>
    <div id="particles-js" class="eyecandy"></div>

    <div class="book color-theme-2"><div class="book-summary">
    <script type="text/javascript">
        // Fixes the page links scroll problem on both desktop and mobile browsers
        function pageScrollToTop(element) {
            // both mobile and non-mobile
            $('div.body-inner').animate({scrollTop: 0});
            $(element).parent().find('li>ul>li').removeClass('active');
            return true;  // propagate
        }
        // Fixes the anchor links scroll problem on mobile browsers
        function mobilePageScrollToAnchor(element) {
            $(element).closest('li.chapter').find('ul>li').removeClass('active');
            $(element).parent().addClass('active');
            if ($(document).width() <= 1240) {
                $('div.body-inner').animate({scrollTop: $($(element).attr('href')).get(0).offsetTop});
            }
            return true;
        }
    </script>

    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
                <!-- <p>pages</p> -->
                
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/">
                        
                            <a href="/" onclick="pageScrollToTop(this)">
                                About
                            </a>
                            
                                
                            
                        </li>
                        
                        
                            <li class="divider-header">
                                <a>Basics</a>
                            </li>
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/01/">
                        
                            <a href="/pages/1/01/" onclick="pageScrollToTop(this)">
                                Computer Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/02/">
                        
                            <a href="/pages/1/02/" onclick="pageScrollToTop(this)">
                                Game Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/03/">
                        
                            <a href="/pages/1/03/" onclick="pageScrollToTop(this)">
                                Hacking Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/04/">
                        
                            <a href="/pages/1/04/" onclick="pageScrollToTop(this)">
                                Setting Up a VM
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/05/">
                        
                            <a href="/pages/1/05/" onclick="pageScrollToTop(this)">
                                Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                            <li class="divider-header">
                                <a>Debugging & Reversing</a>
                            </li>
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/01/">
                        
                            <a href="/pages/2/01/" onclick="pageScrollToTop(this)">
                                Debugging Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/02/">
                        
                            <a href="/pages/2/02/" onclick="pageScrollToTop(this)">
                                Assembly Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/03/">
                        
                            <a href="/pages/2/03/" onclick="pageScrollToTop(this)">
                                Using Breakpoints
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/04/">
                        
                            <a href="/pages/2/04/" onclick="pageScrollToTop(this)">
                                Changing Game Code
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/05/">
                        
                            <a href="/pages/2/05/" onclick="pageScrollToTop(this)">
                                Reversing Code
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/06/">
                        
                            <a href="/pages/2/06/" onclick="pageScrollToTop(this)">
                                Code Caves
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/07/">
                        
                            <a href="/pages/2/07/" onclick="pageScrollToTop(this)">
                                Using Code Caves
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/08/">
                        
                            <a href="/pages/2/08/" onclick="pageScrollToTop(this)">
                                Dynamic Memory Allocation
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/09/">
                        
                            <a href="/pages/2/09/" onclick="pageScrollToTop(this)">
                                Defeating DMA
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Programming</a>
                            </li>
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/01/">
                        
                            <a href="/pages/3/01/" onclick="pageScrollToTop(this)">
                                Programming Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/02/">
                        
                            <a href="/pages/3/02/" onclick="pageScrollToTop(this)">
                                External Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/03/">
                        
                            <a href="/pages/3/03/" onclick="pageScrollToTop(this)">
                                DLL Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/04/">
                        
                            <a href="/pages/3/04/" onclick="pageScrollToTop(this)">
                                Code Caves &amp; DLL&#39;s
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/05/">
                        
                            <a href="/pages/3/05/" onclick="pageScrollToTop(this)">
                                Printing Text
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>RTS/RPG Hacks</a>
                            </li>
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/01/">
                        
                            <a href="/pages/4/01/" onclick="pageScrollToTop(this)">
                                Stathack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/02/">
                        
                            <a href="/pages/4/02/" onclick="pageScrollToTop(this)">
                                Map Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/03/">
                        
                            <a href="/pages/4/03/" onclick="pageScrollToTop(this)">
                                Macro Bot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/04/">
                        
                            <a href="/pages/4/04/" onclick="pageScrollToTop(this)">
                                Farming Bot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>FPS Hacks</a>
                            </li>
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/01/">
                        
                            <a href="/pages/5/01/" onclick="pageScrollToTop(this)">
                                3D Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/02/">
                        
                            <a href="/pages/5/02/" onclick="pageScrollToTop(this)">
                                Wallhack (Memory)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/03/">
                        
                            <a href="/pages/5/03/" onclick="pageScrollToTop(this)">
                                Wallhack (OpenGL)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/04/">
                        
                            <a href="/pages/5/04/" onclick="pageScrollToTop(this)">
                                Chams (OpenGL)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/05/">
                        
                            <a href="/pages/5/05/" onclick="pageScrollToTop(this)">
                                Triggerbot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/06/">
                        
                            <a href="/pages/5/06/" onclick="pageScrollToTop(this)">
                                Aimbot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/07/">
                        
                            <a href="/pages/5/07/" onclick="pageScrollToTop(this)">
                                No Recoil
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/08/">
                        
                            <a href="/pages/5/08/" onclick="pageScrollToTop(this)">
                                Radar Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/09/">
                        
                            <a href="/pages/5/09/" onclick="pageScrollToTop(this)">
                                ESP
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/10/">
                        
                            <a href="/pages/5/10/" onclick="pageScrollToTop(this)">
                                Multihack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Multiplayer</a>
                            </li>
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/01/">
                        
                            <a href="/pages/6/01/" onclick="pageScrollToTop(this)">
                                Multiplayer Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter active" data-level="1.2" data-path="/pages/6/02/">
                        
                            <a href="/pages/6/02/" onclick="pageScrollToTop(this)">
                                Packet Analysis
                            </a>
                            
                                
                                    <ul><li><a href="#target" onclick="mobilePageScrollToAnchor(this)" >Target</a></li><li><a href="#identify" onclick="mobilePageScrollToAnchor(this)" >Identify</a></li><li><a href="#understand" onclick="mobilePageScrollToAnchor(this)" >Understand</a></li><li><a href="#local-server" onclick="mobilePageScrollToAnchor(this)" >Local Server</a></li><li><a href="#observing-packets" onclick="mobilePageScrollToAnchor(this)" >Observing Packets</a></li><li><a href="#packet-structure" onclick="mobilePageScrollToAnchor(this)" >Packet Structure</a></li><li><a href="#sockets" onclick="mobilePageScrollToAnchor(this)" >Sockets</a></li><li><a href="#reversing-packets" onclick="mobilePageScrollToAnchor(this)" >Reversing Packets</a></li></ul>

                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/03/">
                        
                            <a href="/pages/6/03/" onclick="pageScrollToTop(this)">
                                Reversing Packets
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/04/">
                        
                            <a href="/pages/6/04/" onclick="pageScrollToTop(this)">
                                Creating an External Client
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/05/">
                        
                            <a href="/pages/6/05/" onclick="pageScrollToTop(this)">
                                Proxying TCP Traffic
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Tool Development</a>
                            </li>
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/01/">
                        
                            <a href="/pages/7/01/" onclick="pageScrollToTop(this)">
                                DLL Injector
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/02/">
                        
                            <a href="/pages/7/02/" onclick="pageScrollToTop(this)">
                                Pattern Scanner
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/03/">
                        
                            <a href="/pages/7/03/" onclick="pageScrollToTop(this)">
                                Memory Scanner
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/04/">
                        
                            <a href="/pages/7/04/" onclick="pageScrollToTop(this)">
                                Disassembler
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/05/">
                        
                            <a href="/pages/7/05/" onclick="pageScrollToTop(this)">
                                Debugger
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/06/">
                        
                            <a href="/pages/7/06/" onclick="pageScrollToTop(this)">
                                Call Logger
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Game Resources</a>
                            </li>
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/01/">
                        
                            <a href="/pages/8/01/" onclick="pageScrollToTop(this)">
                                Resource Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/02/">
                        
                            <a href="/pages/8/02/" onclick="pageScrollToTop(this)">
                                Modifying Save Data
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/03/">
                        
                            <a href="/pages/8/03/" onclick="pageScrollToTop(this)">
                                Modifying Textures
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/04/">
                        
                            <a href="/pages/8/04/" onclick="pageScrollToTop(this)">
                                Modifying Units
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                
            
                <!-- <p>posts</p> -->
                
                    

                    
                
            
        </ul>

        &nbsp;
    </nav>
</div>
<div class="book-body">
        <div class="book-header" role="navigation">
          <!-- Title -->
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
            <a href=".">Packet Analysis</a>
            
          </h1>
        </div>

        <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    

                    <h1 id="target">Target</h1>

<p>Our target in this lesson will be Wesnoth 1.14.9.</p>

<h1 id="identify">Identify</h1>

<p>Like many games, Wesnoth has a multiplayer mode that allows multiple
players to join a lobby, chat with each other, and play games against each
other over a network. Our goal in this lesson is to analyze the packets used
for connecting to the lobby and create a client that will connect to a
lobby.</p>

<p><img src="/assets/images/6/2/bot1.png" alt="Multiplayer Lobby" /></p>

<h1 id="understand">Understand</h1>

<p>For multiple players to communicate over a network, all of the clients (in
this case, the Wesnoth game executable) must agree on a network model and
protocol. They also must agree on the data each packet will contain. If
there is a server, the server must also agree with all of these
components.</p>

<p>Since this data is structured, we can first identify the network model and
protocol used by the game. Then, we can observe the packets being sent and
reverse the data to determine what each packet is doing. We can then use
the data in these packets to create our own client using the Windows’
Socket API.</p>

<h1 id="local-server">Local Server</h1>

<p>If you start Wesnoth and click <em>Multiplayer</em>, you will see the
following screen:</p>

<p><img src="/assets/images/6/2/bot2.png" alt="Multiplayer Lobby" /></p>

<p>These entries indicate that Wesnoth is using a client-server model. If we
explore the Wesnoth game folder in
<em>C:\Program Files (x86)\Battle for Wesnoth 1.14.9</em>, you will find a
program called <em>wesnothd.exe</em>. Reading the <a href="https://wiki.wesnoth.org/MultiplayerServers">documentation</a> on
the developer’s website, we know that this is a server daemon that allows
you to host a server. It can be run by invoking it from the command
prompt:</p>

<p><img src="/assets/images/6/2/bot3.png" alt="Multiplayer Lobby" /></p>

<p>With the server running, we can now connect to it from Wesnoth. In the
previous lesson, we discussed how clients need to know two pieces of
information to connect to another host: the IP address and the port. In
this case, the server is running on our local machine. There are several
reserved IP address ranges that will never be used for normal network
assignments. One of these is the range from 127.0.0.0 to 127.255.255.255,
which is reserved for loopback addresses on the local machine. The
loopback component indicates that the external network will not be able to
access these IP ranges.</p>

<p>On all operating systems, 127.0.0.1 will always direct to your current
host. In addition, localhost is a hostname that directs to 127.0.0.1.
Therefore, we know that the IP for this server is 127.0.0.1 or localhost.
From the documentation, we know that the server runs by default on port 15000. With these two pieces of information, we can connect to the server.</p>

<p>Choose <em>Connect to Server</em> and then enter in <em>localhost:15000</em>:</p>

<p><img src="/assets/images/6/2/bot4.png" alt="Multiplayer Lobby" /></p>

<p>When you hit <em>Connect</em>, your client will join a multiplayer lobby. If
you observe the server running in the command prompt, you should see that
it has printed out the connection event:</p>

<p><img src="/assets/images/6/2/bot5.png" alt="Multiplayer Lobby" /></p>

<h1 id="observing-packets">Observing Packets</h1>

<p>With the server running, we can close the Wesnoth client and start the
process of observing packets. There are many tools that can be used, but
for these lessons, we will use Wireshark. This can be installed via:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">choco</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">wireshark</span><span class="w">
</span></code></pre></div></div>

<p>The first time you use Wireshark, you will also need to install the
WinPcap driver as instructed by the program.</p>

<p>With Wireshark and the driver installed, you can pick a network interface
to observe on:</p>

<p><img src="/assets/images/6/2/bot6.png" alt="Wireshark Interface" /></p>

<p>Each listed network interface represents a piece of software or hardware
that connects to a public or private network. For example, the
<em>Ethernet0</em> interface listed is the default network card used to
communicate over the Internet for this particular VM. Depending on your VM
and computer, these interfaces may be different.</p>

<p>In this case, we know all of the traffic for our game will be flowing on
the loopback interface, so select
<em>Adapter for loopback traffic capture</em>. Upon selecting this,
Wireshark will start monitoring for packets. Open up Wesnoth and connect
to the local server. When connecting, you should see Wireshark log
multiple packets:</p>

<p><img src="/assets/images/6/2/bot7.png" alt="Wireshark Logging" /></p>

<p>Initially, this can appear overwhelming, so let’s break down what exactly
we are seeing here and identify what we care about. In the protocol
column, we can see that Wesnoth is using <em>TCP</em>:</p>

<p><img src="/assets/images/6/2/bot7a.png" alt="Wireshark Logging" /></p>

<p>We know from the previous lesson that TCP initiates an upfront connection and
acknowledges when packets have been received. This initial negotiation is
known as a three-way handshake, and has three parts:</p>

<ol>
  <li>One side sends a packet with a <em>SYN</em> flag.</li>
  <li>The other side responds with <em>SYN</em> and <em>ACK</em> flags.</li>
  <li>The first side sends an <em>ACK</em> flag.</li>
</ol>

<p>We can see this behavior in the first few packets highlighted below:</p>

<p><img src="/assets/images/6/2/bot7b.png" alt="Wireshark Logging" /></p>

<p>Since we know 15000 is the server’s port, we can determine that 50563 is
our client’s port. However, this number will probably not match the number
you are seeing. If we close Wesnoth and start it again, we will also see
that this number changes:</p>

<p><img src="/assets/images/6/2/bot7c.png" alt="Wireshark Logging" /></p>

<p>This is an example of an ephemeral, or short-lived, port. Since the
Wesnoth client does not need to be discoverable by other users, it can
choose a “random” available port each time it starts up. When the client
is closed, it will free this port. This is in contrast to the server,
which always needs to be discoverable on port 15000 by clients.</p>

<p>None of the packets we have examined so far contain any data. We can
determine this by looking at the <em>len</em> member:</p>

<p><img src="/assets/images/6/2/bot7d.png" alt="Wireshark Logging" /></p>

<p>Looking at all the packets, we can see that the only packets with data
have the PSH flag. This flag tells the TCP connection to immediately send
whatever data is inside the packet to the associated application instead
of placing it in a buffer. We can filter for this flag in Wireshark to
only see the packets that we care about via <em>tcp.flags.push == 1</em>:</p>

<p><img src="/assets/images/6/2/bot8.png" alt="Wireshark Logging" /></p>

<h1 id="packet-structure">Packet Structure</h1>

<p>When you select a packet in Wireshark, it displays the full packet broken
down in different segments. For example, if we select the first packet of
<em>len</em> 4, we will see the following view:</p>

<p><img src="/assets/images/6/2/bot9.png" alt="Wireshark Logging" /></p>

<p>As you select different components (like <em>IP</em> and <em>TCP</em>), the
associated parts of the packet will be highlighted in the bottom section.
For example, by selecting the <em>TCP</em> component, the following section
is highlighted:</p>

<p><img src="/assets/images/6/2/bot10.png" alt="Wireshark Logging" /></p>

<p>For the purposes of this lesson, we can ignore the IP and TCP components and
focus on the data component for all the packets:</p>

<p><img src="/assets/images/6/2/bot11.png" alt="Wireshark Logging" /></p>

<p>Given that data in packets is often compressed, it is difficult to
determine the purpose of a single packet in isolation. Instead, it is
easier to look at the overall flow of network traffic and determine the
role of each packet. In our case, the flow of network traffic for
connecting looks like:</p>

<p><img src="/assets/images/6/2/bot8.png" alt="Wireshark Logging" /></p>

<p>We know that packets from <em>50563</em> -&gt; <em>15000</em> represent
communication sent from our client to the server, and <em>15000</em> -&gt;
<em>50563</em> represent communication sent from the server to our client.
As such, the network traffic looks like:</p>

<ol>
  <li>Client -&gt; Server Packet 1</li>
  <li>Server -&gt; Client</li>
  <li>Client -&gt; Server Packet 2</li>
  <li>Server -&gt; Client</li>
  <li>Client -&gt; Server Packet 3</li>
</ol>

<p>Since we are writing a client, we will only need to reverse the three
packets being sent from the client to the server.</p>

<h1 id="sockets">Sockets</h1>

<p>Each OS will have its own set of API’s that allows you to interact with
the networking stack. In Windows, this API is known as Winsock. Microsoft
has comprehensive documentation available on how to use this API,
including the process to establish a socket. This is available <a href="https://docs.microsoft.com/en-us/windows/win32/winsock/getting-started-with-winsock">here.</a></p>

<p>Microsoft also provides a complete example using these API’s <a href="https://docs.microsoft.com/en-us/windows/win32/winsock/complete-client-code">here.</a> This example will create a TCP connection to a provided IP on port 27015
and send a single packet containing the data
<strong>this is a test</strong>. It will then continuously wait for
packets from the server. We will base our code on this example.</p>

<p>A good starting place is to see how the server responds when we simply use
the code as is. Since we are targeting a specific IP, we will remove the
following code from the example:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"usage: %s server-name</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Next, we can modify the <strong>getaddrinfo</strong> function to use the
values for our server:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iResult</span> <span class="o">=</span> <span class="n">getaddrinfo</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="s">"15000"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hints</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">);</span>
</code></pre></div></div>

<p>With these changes, compile the code and run the executable. If you have
Wireshark still logging, you should notice your host sending a packet with
the data <strong>this is a test</strong> to the server. If you look at the
server process, you will see the following message:</p>

<p><img src="/assets/images/6/2/bot12.png" alt="Wesnoth Server Message" /></p>

<h1 id="reversing-packets">Reversing Packets</h1>

<p>This message indicates that the first packets sent by our client must
initiate some sort of handshake. Let’s compare the first message logged by
the server for a valid connection:</p>

<p><img src="/assets/images/6/2/bot13.png" alt="Wesnoth Server Message" /></p>

<p>Going back to our Wireshark capture, we can see that the first packet sent
by the client contains <code class="language-plaintext highlighter-rouge">00 00 00 00</code>. The server then responds
with data. From this, we can assume that the data
<code class="language-plaintext highlighter-rouge">00 00 00 00</code> is interpreted by the Wesnoth server as the start
of a handshake.</p>

<p>We can modify our socket example to perform this behavior. First, remove
the following code since we will be writing our own sending code:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Send an initial buffer</span>
<span class="n">iResult</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span> <span class="n">ConnectSocket</span><span class="p">,</span> <span class="n">sendbuf</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">strlen</span><span class="p">(</span><span class="n">sendbuf</span><span class="p">),</span> <span class="mi">0</span> <span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">iResult</span> <span class="o">==</span> <span class="n">SOCKET_ERROR</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"send failed with error: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">WSAGetLastError</span><span class="p">());</span>
  <span class="n">closesocket</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">);</span>
  <span class="n">WSACleanup</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">printf</span><span class="p">(</span><span class="s">"Bytes Sent: %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iResult</span><span class="p">);</span>

<span class="c1">// shutdown the connection since no more data will be sent</span>
<span class="n">iResult</span> <span class="o">=</span> <span class="n">shutdown</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">,</span> <span class="n">SD_SEND</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">iResult</span> <span class="o">==</span> <span class="n">SOCKET_ERROR</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"shutdown failed with error: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">WSAGetLastError</span><span class="p">());</span>
  <span class="n">closesocket</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">);</span>
  <span class="n">WSACleanup</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Next, create a buffer that will hold our <code class="language-plaintext highlighter-rouge">00 00 00 00</code> data:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buff_handshake_p1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Finally, add the following code to send this data and receive a single
packet back:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iResult</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">buff_handshake_p1</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff_handshake_p1</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Bytes Sent: %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iResult</span><span class="p">);</span>

<span class="n">iResult</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">,</span> <span class="n">recvbuf</span><span class="p">,</span> <span class="n">recvbuflen</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Bytes received: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iResult</span><span class="p">);</span>
</code></pre></div></div>

<p>If you run this program, you will receive 41 bytes back. This is equal to
the two responses sent by the server in Wireshark, indicating that the
first packet sent by the client initiates the handshake:</p>

<p><img src="/assets/images/6/2/bot8a.png" alt="Wesnoth Server Message" /></p>

<p>From the server messages, we can see that the next packet the client is
responsible for is sending their current version. An example of this
packet’s data is shown below:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span>
<span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span>
<span class="mh">0xf5</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span>
<span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
<span class="mh">0x00</span>
</code></pre></div></div>

<p>Even when converted into ASCII, our game version (1.14.9) does not appear
in this data. This is because, like most games, Wesnoth compresses all
data by default. In future lessons, we will examine the compression scheme
used so that we can create packets with custom data. However, in this lesson,
we will not need to do this since this data does not change. You can
verify that by joining the same server multiple times with Wireshark
running.</p>

<p>Let’s add this packet to our program to send as well:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buff_handshake_p2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span>
  <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span>
  <span class="mh">0xf5</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span>
  <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span>
<span class="p">};</span>

<span class="n">iResult</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">buff_handshake_p2</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff_handshake_p2</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Bytes Sent: %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iResult</span><span class="p">);</span>

<span class="n">iResult</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">,</span> <span class="n">recvbuf</span><span class="p">,</span> <span class="n">recvbuflen</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Bytes received: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iResult</span><span class="p">);</span>
</code></pre></div></div>

<p>With this additional packet, the Wesnoth server will now think that a
client is sending them a game’s version before closing the connection:</p>

<p><img src="/assets/images/6/2/bot14.png" alt="Wesnoth Server Message" /></p>

<p>Finally, we can add in the name that our client will send. Since we have
control over this field, we can use it to observe the compression scheme
in use. With Wireshark running, connect to a server with two usernames,
one short and one long. In the long username, make sure multiple
characters repeat in a row. This will allow us to detect patterns. In this
lab, we will use the examples of <em>FFFAAAKKKEEE</em> and <em>IEUser</em>.
Their related packets look like:</p>

<p><img src="/assets/images/6/2/bot15.png" alt="Wesnoth Server Message" /></p>

<p>The highlighted areas most likely represent the compressed name of the
user. Let’s try sending the data from the <em>FFFAAAKKKEEE</em> request, but
slightly modifying the bytes for the name:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buff_send_name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span>
  <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span>
  <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span>
  <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xd6</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span>
  <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>

<span class="n">iResult</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">buff_send_name</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff_send_name</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Bytes Sent: %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iResult</span><span class="p">);</span>
</code></pre></div></div>

<p>If we observe the server, we see the following error:</p>

<p><img src="/assets/images/6/2/bot16.png" alt="Wesnoth Server Message" /></p>

<p>This verifies that the packet is being compressed, and even indicates the
compression scheme (<em>simple_wml</em>). We can use this information in
future lessons when we want to create our own packet. For this lesson, we can
just modify <strong>buff_send_name</strong> to contain the original data:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buff_send_name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span>
<span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span>
<span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span>
<span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xd6</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span>
<span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>
</code></pre></div></div>

<p>With this change, our client will now connect to the server using the name
<em>FFFAAAKKKEEE</em>. If you join the lobby with a legitimate client, you
will notice that our client is also connected.</p>

<p><img src="/assets/images/6/2/bot17.png" alt="Wesnoth Server Message" /></p>

<p>The full code for this client is available on <a href="https://github.com/GameHackingAcademy/Wesnoth_MultiplayerBot/">github.</a></p>

<p> </p>


                </section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
    </div>
</div>

<!-- introduce mathjax support -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script
  type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


<!-- introduce per-page mermaid support -->


          <a
            href="/pages/6/01/"
            class="navigation navigation-prev navigation-unique"
            aria-label="Previous page: Multiplayer Fundamentals"
          >
            <i class="fa fa-angle-left"></i>
          </a>
           
          <a
            href="/pages/6/03/"
            class="navigation navigation-next navigation-unique"
            aria-label="Next page: Reversing Packets"
          >
            <i class="fa fa-angle-right"></i>
          </a>
          
        </div>
      </div>

      <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "Reversing Packets",
            "level": "1.2",
            "depth": 1,
            "path": "_pages/6/03.md",
            "ref": "_pages/6/03.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "facebook": false,

                "google": false,

                "github": true,
                "github_link": "https://github.com/GameHackingAcademy",

                "telegram": false,
                "telegram_link": "https://t.me",

                "instapaper": false,

                "twitter": true,
                "twitter_link": "https://twitter.com/GameHackingAcad",

                "vk": false,

                "weibo": false
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Game Hacking Academy",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_pages/6/02.md",
        "mtime": "2023-12-25 00:00:00 -0600",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2023-12-31 12:09:34 -0600"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
        });
      </script>
    </div><script src="/assets/gitbook/gitbook.js"></script>
<script src="/assets/gitbook/theme.js"></script>

<script src="/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> -->

<script src="/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
<script src="/assets/gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>

<!-- trackers --><!-- google analytics --><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160704775-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160704775-1');
</script>
<script>
      particlesJS("particles-js", {
        particles: {
          number: {
            value: 20,
            density: {
              enable: true,
              value_area: 100,
            },
          },
          color: {
            value: "#6195b9",
          },
          shape: {
            type: "edge",
          },
          opacity: {
            value: 0.3,
            anim: {
              enable: true,
              speed: 0.1,
              opacity_min: 0,
              sync: false,
            },
          },
          size: {
            value: 15,
            random: true,
          },
          line_linked: {
            enable: false,
          },
          move: {
            enable: true,
            speed: 0.5,
            direction: "top",
            random: true,
            straight: true,
            out_mode: "out",
            bounce: false,
            attract: {
              enable: false,
            },
          },
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: {
              enable: false,
            },
            onclick: {
              enable: false,
            },
            resize: true,
          },
        },
      });
    </script>
  </body>
</html>
