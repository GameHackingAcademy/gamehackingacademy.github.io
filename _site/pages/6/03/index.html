<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Reversing Packets · Game Hacking Academy</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Game hacking tutorials and lessons.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="attilathedud"><link rel="stylesheet" href="/assets/gitbook/style.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">

<link rel="stylesheet" href="/assets/gitbook/rouge/base16.css">

<link rel="stylesheet" href="/assets/gitbook/custom.css">
<link rel="stylesheet" href="/assets/gitbook/custom-local.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">

<script src="/assets/particles.min.js"></script>

<style>
    @media screen and (min-width: 1101px) {
      .eyecandy {
        position: fixed;
        bottom: 0;
        right: 0;
        min-height: 50%;
        height: 50%;
        width: 25%;
        pointer-events: none;
        z-index: 1;
      }
    }
    @media screen and (max-width: 1100px) {
      .eyecandy {
        display: none;
      }
    }
  </style>






    <link rel="prev" href="/pages/6/02/" />
     
    <link rel="next" href="/pages/6/04/" />
    
    
  </head>
  <body>
    <div id="particles-js" class="eyecandy"></div>

    <div class="book color-theme-2"><div class="book-summary">
    <script type="text/javascript">
        // Fixes the page links scroll problem on both desktop and mobile browsers
        function pageScrollToTop(element) {
            // both mobile and non-mobile
            $('div.body-inner').animate({scrollTop: 0});
            $(element).parent().find('li>ul>li').removeClass('active');
            return true;  // propagate
        }
        // Fixes the anchor links scroll problem on mobile browsers
        function mobilePageScrollToAnchor(element) {
            $(element).closest('li.chapter').find('ul>li').removeClass('active');
            $(element).parent().addClass('active');
            if ($(document).width() <= 1240) {
                $('div.body-inner').animate({scrollTop: $($(element).attr('href')).get(0).offsetTop});
            }
            return true;
        }
    </script>

    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
                <!-- <p>pages</p> -->
                
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/">
                        
                            <a href="/" onclick="pageScrollToTop(this)">
                                About
                            </a>
                            
                                
                            
                        </li>
                        
                        
                            <li class="divider-header">
                                <a>Basics</a>
                            </li>
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/01/">
                        
                            <a href="/pages/1/01/" onclick="pageScrollToTop(this)">
                                Computer Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/02/">
                        
                            <a href="/pages/1/02/" onclick="pageScrollToTop(this)">
                                Game Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/03/">
                        
                            <a href="/pages/1/03/" onclick="pageScrollToTop(this)">
                                Hacking Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/04/">
                        
                            <a href="/pages/1/04/" onclick="pageScrollToTop(this)">
                                Setting Up a VM
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/05/">
                        
                            <a href="/pages/1/05/" onclick="pageScrollToTop(this)">
                                Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                            <li class="divider-header">
                                <a>Debugging & Reversing</a>
                            </li>
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/01/">
                        
                            <a href="/pages/2/01/" onclick="pageScrollToTop(this)">
                                Debugging Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/02/">
                        
                            <a href="/pages/2/02/" onclick="pageScrollToTop(this)">
                                Assembly Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/03/">
                        
                            <a href="/pages/2/03/" onclick="pageScrollToTop(this)">
                                Using Breakpoints
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/04/">
                        
                            <a href="/pages/2/04/" onclick="pageScrollToTop(this)">
                                Changing Game Code
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/05/">
                        
                            <a href="/pages/2/05/" onclick="pageScrollToTop(this)">
                                Reversing Code
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/06/">
                        
                            <a href="/pages/2/06/" onclick="pageScrollToTop(this)">
                                Code Caves
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/07/">
                        
                            <a href="/pages/2/07/" onclick="pageScrollToTop(this)">
                                Using Code Caves
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/08/">
                        
                            <a href="/pages/2/08/" onclick="pageScrollToTop(this)">
                                Dynamic Memory Allocation
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/09/">
                        
                            <a href="/pages/2/09/" onclick="pageScrollToTop(this)">
                                Defeating DMA
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Programming</a>
                            </li>
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/01/">
                        
                            <a href="/pages/3/01/" onclick="pageScrollToTop(this)">
                                Programming Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/02/">
                        
                            <a href="/pages/3/02/" onclick="pageScrollToTop(this)">
                                External Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/03/">
                        
                            <a href="/pages/3/03/" onclick="pageScrollToTop(this)">
                                DLL Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/04/">
                        
                            <a href="/pages/3/04/" onclick="pageScrollToTop(this)">
                                Code Caves &amp; DLL&#39;s
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/05/">
                        
                            <a href="/pages/3/05/" onclick="pageScrollToTop(this)">
                                Printing Text
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>RTS/RPG Hacks</a>
                            </li>
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/01/">
                        
                            <a href="/pages/4/01/" onclick="pageScrollToTop(this)">
                                Stathack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/02/">
                        
                            <a href="/pages/4/02/" onclick="pageScrollToTop(this)">
                                Map Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/03/">
                        
                            <a href="/pages/4/03/" onclick="pageScrollToTop(this)">
                                Macro Bot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/04/">
                        
                            <a href="/pages/4/04/" onclick="pageScrollToTop(this)">
                                Farming Bot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>FPS Hacks</a>
                            </li>
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/01/">
                        
                            <a href="/pages/5/01/" onclick="pageScrollToTop(this)">
                                3D Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/02/">
                        
                            <a href="/pages/5/02/" onclick="pageScrollToTop(this)">
                                Wallhack (Memory)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/03/">
                        
                            <a href="/pages/5/03/" onclick="pageScrollToTop(this)">
                                Wallhack (OpenGL)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/04/">
                        
                            <a href="/pages/5/04/" onclick="pageScrollToTop(this)">
                                Chams (OpenGL)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/05/">
                        
                            <a href="/pages/5/05/" onclick="pageScrollToTop(this)">
                                Triggerbot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/06/">
                        
                            <a href="/pages/5/06/" onclick="pageScrollToTop(this)">
                                Aimbot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/07/">
                        
                            <a href="/pages/5/07/" onclick="pageScrollToTop(this)">
                                No Recoil
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/08/">
                        
                            <a href="/pages/5/08/" onclick="pageScrollToTop(this)">
                                Radar Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/09/">
                        
                            <a href="/pages/5/09/" onclick="pageScrollToTop(this)">
                                ESP
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/10/">
                        
                            <a href="/pages/5/10/" onclick="pageScrollToTop(this)">
                                Multihack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Multiplayer</a>
                            </li>
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/01/">
                        
                            <a href="/pages/6/01/" onclick="pageScrollToTop(this)">
                                Multiplayer Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/02/">
                        
                            <a href="/pages/6/02/" onclick="pageScrollToTop(this)">
                                Packet Analysis
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter active" data-level="1.2" data-path="/pages/6/03/">
                        
                            <a href="/pages/6/03/" onclick="pageScrollToTop(this)">
                                Reversing Packets
                            </a>
                            
                                
                                    <ul><li><a href="#target" onclick="mobilePageScrollToAnchor(this)" >Target</a></li><li><a href="#identify" onclick="mobilePageScrollToAnchor(this)" >Identify</a></li><li><a href="#understand" onclick="mobilePageScrollToAnchor(this)" >Understand</a></li><li><a href="#chat-packets" onclick="mobilePageScrollToAnchor(this)" >Chat Packets</a></li><li><a href="#test-cases" onclick="mobilePageScrollToAnchor(this)" >Test Cases</a></li><li><a href="#packet-modification" onclick="mobilePageScrollToAnchor(this)" >Packet Modification</a></li><li><a href="#compression" onclick="mobilePageScrollToAnchor(this)" >Compression</a></li><li><a href="#packet-structure" onclick="mobilePageScrollToAnchor(this)" >Packet Structure</a></li><li><a href="#creating-a-packet" onclick="mobilePageScrollToAnchor(this)" >Creating a Packet</a></li></ul>

                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/04/">
                        
                            <a href="/pages/6/04/" onclick="pageScrollToTop(this)">
                                Creating an External Client
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/05/">
                        
                            <a href="/pages/6/05/" onclick="pageScrollToTop(this)">
                                Proxying TCP Traffic
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Tool Development</a>
                            </li>
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/01/">
                        
                            <a href="/pages/7/01/" onclick="pageScrollToTop(this)">
                                DLL Injector
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/02/">
                        
                            <a href="/pages/7/02/" onclick="pageScrollToTop(this)">
                                Pattern Scanner
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/03/">
                        
                            <a href="/pages/7/03/" onclick="pageScrollToTop(this)">
                                Memory Scanner
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/04/">
                        
                            <a href="/pages/7/04/" onclick="pageScrollToTop(this)">
                                Disassembler
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/05/">
                        
                            <a href="/pages/7/05/" onclick="pageScrollToTop(this)">
                                Debugger
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/06/">
                        
                            <a href="/pages/7/06/" onclick="pageScrollToTop(this)">
                                Call Logger
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Game Resources</a>
                            </li>
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/01/">
                        
                            <a href="/pages/8/01/" onclick="pageScrollToTop(this)">
                                Resource Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/02/">
                        
                            <a href="/pages/8/02/" onclick="pageScrollToTop(this)">
                                Modifying Save Data
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/03/">
                        
                            <a href="/pages/8/03/" onclick="pageScrollToTop(this)">
                                Modifying Textures
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/04/">
                        
                            <a href="/pages/8/04/" onclick="pageScrollToTop(this)">
                                Modifying Units
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                
            
                <!-- <p>posts</p> -->
                
                    

                    
                
            
        </ul>

        &nbsp;
    </nav>
</div>
<div class="book-body">
        <div class="book-header" role="navigation">
          <!-- Title -->
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
            <a href=".">Reversing Packets</a>
            
          </h1>
        </div>

        <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    

                    <h1 id="target">Target</h1>

<p>Our target in this lesson will be Wesnoth 1.14.9.</p>

<h1 id="identify">Identify</h1>

<p>In the previous lesson, we identified the packets used for connecting to a
Wesnoth server. We then wrote a client that would replay these packets. In
this lesson, we will identify the packets used for sending chat messages and
reverse their structure. This will allow us to create our own legitimate
packets instead of only replaying packets.</p>

<h1 id="understand">Understand</h1>

<p>For clients and servers to communicate over a network, both sides must
agree on how to structure the data in each packet. Since this structure
must be reversible for each side, we can also reverse it. Once the data is
reversed, we can modify the data and do the opposite of the reversing
process to create a new packet.</p>

<h1 id="chat-packets">Chat Packets</h1>

<p>Similar to reversing an executable, it is helpful to have a context when
reversing packets. With executables, this context is often a string that
we have observed inside the executable. When it comes to packets, this
context is some type of data we can control in the packet.</p>

<p>Typically, you control several pieces of data in a packet. For example,
most games allow you to set your name. Other games will allow you to
connect with multiple versions or certain mods. Both of these pieces would
allow you to associate certain data with certain packets. However, one of
the easiest pieces of data to control is a game’s chat messages. Since
Wesnoth allows players to send chat messages, this is the context we will
use for this lesson.</p>

<p>Start Wesnoth and connect to your local server with a user named
<em>FFFAAAKKKEEE</em>, identically to the last lesson. Once connected, start
Wireshark to log packets. To help reverse the game’s packets, we want to
answer a few questions:</p>

<ol>
  <li>Is there any randomness or time element encoded in the packets?</li>
  <li>Can we observe patterns of letters in the packets?</li>
  <li>Can we observe any human-readable characters in the packets?</li>
</ol>

<p>To answer these questions, we can send the following four chat messages:</p>

<ul>
  <li><em>a</em></li>
  <li><em>a</em></li>
  <li><em>aaaaa</em></li>
  <li><em>hello123</em></li>
</ul>

<p><img src="/assets/images/6/3/packet1.png" alt="Wesnoth Chat Messages" /></p>

<p>The first two messages are identical and will help us determine if
identical messages result in identical packets. The third message repeats
a several times, allowing us to observe any type of data patterns.
Finally, the last message will immediately tell us if it appears readable
in a packet.</p>

<h1 id="test-cases">Test Cases</h1>

<p>Examining the data of the first two packets (<em>a</em> and <em>a</em>), we
can see that their data is identical. This means that the packets do not
contain a timestamp or any other uniqueness factor:</p>

<p><img src="/assets/images/6/3/packet2.png" alt="Wesnoth Chat Messages" /></p>

<p>Next, examining the data of the third packet (<em>aaaaa</em>), we see a
pattern toward the end:</p>

<p><img src="/assets/images/6/3/packet3.png" alt="Wesnoth Chat Messages" /></p>

<p>This pattern is too long for <em>aaaaa</em>, and its structure of 3-3-3-3 is
closest to our player’s name (<em>FFFAAAKKKEEE</em>). We can see that this
pattern also occurs in all of our messages, indicating that one element of
this packet must contain our player’s name.</p>

<p>Finally, examining the data of the last packet, we cannot observe anything
that would resemble <em>hello123</em>.</p>

<p>Next, let’s observe the difference between the packets for the message
<em>a</em> and a new message <em>b</em> to help determine how single
characters are handled:</p>

<p><img src="/assets/images/6/3/packet4.png" alt="Wesnoth Chat Messages" /></p>

<p>Comparing these two packets side by side, we find that the
single-character modification resulted in 2 of the bytes being changed in
the middle of the packet, and several bytes being changed at the end:</p>

<p><img src="/assets/images/6/3/packet5.png" alt="Wesnoth Chat Messages" /></p>

<p>This demonstrates that our text is not being mapped one-to-one into a
packet, and additional processing is taking place. With this information,
we can close Wesnoth and stop logging packets in Wireshark. However, make
sure to keep Wireshark running so we can grab packet data as we analyze it
further.</p>

<h1 id="packet-modification">Packet Modification</h1>

<p>Now, let’s see how the server responds if we modify a packet. In the last
lab, we wrote a client that would connect to the server with the username
FFFAAAKKKEEE. We can expand on this code to send a chat message a after we
connect.</p>

<p>In Wireshark, click on the first or second packet (the a messages) and
select the data. Right-click and choose <em>Show Packet Bytes</em>:</p>

<p><img src="/assets/images/6/3/packet6.png" alt="Wesnoth Chat Messages" /></p>

<p>In the window that appears, choose <em>C Array</em> in the
<em>Show As</em> section. This will format the packet’s data into an array
that can be dropped directly into your code.</p>

<p><img src="/assets/images/6/3/packet7.png" alt="Wesnoth Chat Messages" /></p>

<p>After we have sent the handshake, version, and username packets, we can
add the following code to send the chat message:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">packet_bytes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span>
  <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span>
  <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span>
  <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span>
  <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span>
  <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span>
  <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span>
  <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span>
  <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>

<span class="n">iResult</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">ConnectSocket</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">packet_bytes</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">packet_bytes</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Bytes Sent: %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">iResult</span><span class="p">);</span>
</code></pre></div></div>

<p>Executing this code will send a chat message just as if we were connected:</p>

<p><img src="/assets/images/6/3/packet8.png" alt="Wesnoth Chat Messages" /></p>

<p>In the section above, we saw that the difference between the <em>a</em> and
<em>b</em> chat messages was a change of 2 bytes. Let’s change only the 2
bytes above and see how the server responds:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">packet_bytes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span>
  <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span>
  <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span>
  <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span>
  <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span>
  <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span>
  <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span>
  <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span>
  <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Executing the code with this packet will result in the following error
from the server:</p>

<p><img src="/assets/images/6/3/packet9.png" alt="Wesnoth Chat Messages" /></p>

<p>This error message, plus how a single letter change results in multiple
modifications to the bytes in the packet, indicates that at least some
part of the packet is compressed.</p>

<h1 id="compression">Compression</h1>

<p>Compression is the process of taking input data and reducing its size. One
of the most simplistic compression techniques is combining repeating data.
For example, the string <em>AAAAAAAAAA</em> could become <em>10A</em>. When
decompressed, the decompressor would know to expand <em>10A</em> back to
<em>AAAAAAAAAA</em>. There are multiple ways to compress data, with some
popular formats being ZIP and RAR. Just like executables are always
distinct from other data (like pictures), different compression formats
are distinct from each other.</p>

<p>Wesnoth is a multi-platform game that supports Windows and Linux.
Therefore, we know that whatever format being used must run on both OS’s.
On Linux-based systems, two of the most popular compression formats are
gzip and bzip2. We will start our investigation with these formats.</p>

<p>Windows’ default command prompt does not have good support for data
operations. To help us investigate, we will use another terminal emulator
called Cmder. We will also install the gzip package. Both of these can be
installed using Chocolatey in Powershell:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">choco</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">cmder</span><span class="w"> </span><span class="nt">-y</span><span class="w">
</span><span class="n">choco</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">gzip</span><span class="w"> </span><span class="nt">-y</span><span class="w">
</span></code></pre></div></div>

<p>To test out the two compression techniques, create a text file named
test.txt. In this file, add a single line of text. Next, open up Cmder
(<em>C:\Tools\Cmder.exe</em>) and navigate to the directory with this text
file. Run the following command to create a gzip’d version of the file:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gzip</span><span class="w"> </span><span class="nx">test.txt</span><span class="w">
</span></code></pre></div></div>

<p>By default, gzip will remove the original file. Recreate test.txt in the
same way so that you can then create a bzip’d version:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bzip2</span><span class="w"> </span><span class="nx">test.txt</span><span class="w">
</span></code></pre></div></div>

<p>You should now have two files: test.txt.gz and test.txt.bz2. We next want
to examine what the bytes of these files look like. To do this, we can use
a tool called <strong>xxd</strong>:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xxd</span><span class="w"> </span><span class="nx">test.txt.gz</span><span class="w">
</span><span class="n">xxd</span><span class="w"> </span><span class="nx">test.txt.bz2</span><span class="w">
</span></code></pre></div></div>

<p>Your results should look similar to the following:</p>

<p><img src="/assets/images/6/3/packet10.png" alt="Wesnoth Chat Messages" /></p>

<p>Comparing these against one of the packets, you should immediately notice
that the beginning bytes (<code class="language-plaintext highlighter-rouge">0x1f8b</code>) jump out in the packet:</p>

<p><img src="/assets/images/6/3/packet11.png" alt="Wesnoth Chat Messages" /></p>

<p>This indicates that part of the packet may be compressed with gzip. We can
validate this by attempting to decompress an actual packet. In Wireshark,
select a packet, right-click on the data, and choose <em>Copy</em> -&gt;
<em>Value</em>:</p>

<p><img src="/assets/images/6/3/packet12.png" alt="Wesnoth Chat Messages" /></p>

<p>We can use xxd again to turn this data into a gzip’d file. To do this, we
will first print the data to the terminal using the command echo. However,
instead of only printing, we will pass this printed text to
<strong>xxd</strong> via the pipe operator (<strong>|</strong>). We can
then use the <strong>-r</strong> switch to tell xxd to reverse the
operation (or create a file from the hex), and the
<strong>-p</strong> switch to tell xxd to read from whatever is typed in,
in this case the echo command. Finally, we use the redirection operator
(<strong>&gt;</strong>) to save this to a compressed file:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">echo</span><span class="w"> </span><span class="s2">"1f8b08....."</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xxd</span><span class="w"> </span><span class="nt">-r</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">file.gz</span><span class="w">
</span></code></pre></div></div>

<p>We can then decompress this file using gzip:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gzip</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">file.gz</span><span class="w">
</span></code></pre></div></div>

<p>This will produce a text file named <em>file</em>. Viewing this file, we can
see structured data representing our chat message:</p>

<p><img src="/assets/images/6/3/packet13.png" alt="Wesnoth Chat Messages" /></p>

<h1 id="packet-structure">Packet Structure</h1>

<p>We now know that the majority of the packet contains compressed data, but
there is still one piece of the packet we have not reversed yet. Looking
at the packet again, we can see that the data
<code class="language-plaintext highlighter-rouge">0x00 00 00 4e</code> comes before the compressed section:</p>

<p><img src="/assets/images/6/3/packet2.png" alt="Wesnoth Chat Messages" /></p>

<p>If we convert this <code class="language-plaintext highlighter-rouge">0x4E</code> into decimal, we get the value 78.
Examining the length of the data section of the packet, we see that it is 82. From this we can deduce that the first 4 bytes of the packet are
responsible for holding the size of the compressed data. With this, we
have all the information we need to create our own packet.</p>

<h1 id="creating-a-packet">Creating a Packet</h1>

<p>Now that we have reversed a packet, we can use the opposite steps to
create our own. In this case, let’s create a chat message that says
<em>z</em> from our chat message that said <em>a</em>. Take the file produced
from our steps above, and change the message to <em>z</em>:</p>

<p><img src="/assets/images/6/3/packet14.png" alt="Wesnoth Chat Messages" /></p>

<p>Next, we are going to gzip this file. We can then use xxd to print out its
byte representation. By using the <strong>-i</strong> flag, xxd will
display this data in a format that we can use in our code:</p>

<p><img src="/assets/images/6/3/packet15.png" alt="Wesnoth Chat Messages" /></p>

<p>We can place this data into our code like before:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">packet_bytes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span>
  <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span>
  <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span>
  <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span>
  <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span>
  <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span>
  <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xda</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>
</code></pre></div></div>

<p>If you examine the chat messages so far and our newly generated message,
you may notice that there is a difference:</p>

<p><img src="/assets/images/6/3/packet16.png" alt="Wesnoth Chat Messages" /></p>

<p>All the other chat messages used by the game have <code class="language-plaintext highlighter-rouge">0x00…ff</code> in
between <code class="language-plaintext highlighter-rouge">0x08</code> and <code class="language-plaintext highlighter-rouge">0x8b</code>. By contrast, our message
has what appears to be random data. To fix this, we can simply replace
these bytes with values that we know work from the game:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">packet_bytes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> 
  <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> 
  <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> 
  <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> 
  <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> 
  <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> 
  <span class="mh">0xda</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This also has the effect of shortening the data. Finally, we need to add
the length to the front of the packet. Since it is a single letter, we
know that it will be <code class="language-plaintext highlighter-rouge">0x4e</code>:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">packet_bytes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> 
  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> 
  <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> 
  <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> 
  <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> 
  <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> 
  <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xda</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>
</code></pre></div></div>

<p>With these changes, we can build and execute the code. The resulting
program will connect to the server and send the chat message <em>z</em>,
proving that we now know the structure and can create our own packets:</p>

<p><img src="/assets/images/6/3/packet17.png" alt="Wesnoth Chat Messages" /></p>

<p> </p>


                </section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
    </div>
</div>

<!-- introduce mathjax support -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script
  type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


<!-- introduce per-page mermaid support -->


          <a
            href="/pages/6/02/"
            class="navigation navigation-prev navigation-unique"
            aria-label="Previous page: Packet Analysis"
          >
            <i class="fa fa-angle-left"></i>
          </a>
           
          <a
            href="/pages/6/04/"
            class="navigation navigation-next navigation-unique"
            aria-label="Next page: Creating an External Client"
          >
            <i class="fa fa-angle-right"></i>
          </a>
          
        </div>
      </div>

      <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "Creating an External Client",
            "level": "1.2",
            "depth": 1,
            "path": "_pages/6/04.md",
            "ref": "_pages/6/04.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "facebook": false,

                "google": false,

                "github": true,
                "github_link": "https://github.com/GameHackingAcademy",

                "telegram": false,
                "telegram_link": "https://t.me",

                "instapaper": false,

                "twitter": true,
                "twitter_link": "https://twitter.com/GameHackingAcad",

                "vk": false,

                "weibo": false
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Game Hacking Academy",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_pages/6/03.md",
        "mtime": "2023-12-25 00:00:00 -0600",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2023-12-26 18:36:09 -0600"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
        });
      </script>
    </div><script src="/assets/gitbook/gitbook.js"></script>
<script src="/assets/gitbook/theme.js"></script>

<script src="/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> -->

<script src="/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
<script src="/assets/gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>

<!-- trackers --><!-- google analytics --><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160704775-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160704775-1');
</script>
<script>
      particlesJS("particles-js", {
        particles: {
          number: {
            value: 20,
            density: {
              enable: true,
              value_area: 100,
            },
          },
          color: {
            value: "#6195b9",
          },
          shape: {
            type: "edge",
          },
          opacity: {
            value: 0.3,
            anim: {
              enable: true,
              speed: 0.1,
              opacity_min: 0,
              sync: false,
            },
          },
          size: {
            value: 15,
            random: true,
          },
          line_linked: {
            enable: false,
          },
          move: {
            enable: true,
            speed: 0.5,
            direction: "top",
            random: true,
            straight: true,
            out_mode: "out",
            bounce: false,
            attract: {
              enable: false,
            },
          },
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: {
              enable: false,
            },
            onclick: {
              enable: false,
            },
            resize: true,
          },
        },
      });
    </script>
  </body>
</html>
