<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>ESP · Game Hacking Academy</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Game hacking tutorials and lessons.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="attilathedud"><link rel="stylesheet" href="/assets/gitbook/style.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">

<link rel="stylesheet" href="/assets/gitbook/rouge/base16.css">

<link rel="stylesheet" href="/assets/gitbook/custom.css">
<link rel="stylesheet" href="/assets/gitbook/custom-local.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">

<script src="/assets/particles.min.js"></script>

<style>
    @media screen and (min-width: 1101px) {
      .eyecandy {
        position: fixed;
        bottom: 0;
        right: 0;
        min-height: 50%;
        height: 50%;
        width: 25%;
        pointer-events: none;
        z-index: 1;
      }
    }
    @media screen and (max-width: 1100px) {
      .eyecandy {
        display: none;
      }
    }
  </style>






    <link rel="prev" href="/pages/5/08/" />
     
    <link rel="next" href="/pages/5/10/" />
    
    
  </head>
  <body>
    <div id="particles-js" class="eyecandy"></div>

    <div class="book color-theme-2"><div class="book-summary">
    <script type="text/javascript">
        // Fixes the page links scroll problem on both desktop and mobile browsers
        function pageScrollToTop(element) {
            // both mobile and non-mobile
            $('div.body-inner').animate({scrollTop: 0});
            $(element).parent().find('li>ul>li').removeClass('active');
            return true;  // propagate
        }
        // Fixes the anchor links scroll problem on mobile browsers
        function mobilePageScrollToAnchor(element) {
            $(element).closest('li.chapter').find('ul>li').removeClass('active');
            $(element).parent().addClass('active');
            if ($(document).width() <= 1240) {
                $('div.body-inner').animate({scrollTop: $($(element).attr('href')).get(0).offsetTop});
            }
            return true;
        }
    </script>

    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
                <!-- <p>pages</p> -->
                
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/">
                        
                            <a href="/" onclick="pageScrollToTop(this)">
                                About
                            </a>
                            
                                
                            
                        </li>
                        
                        
                            <li class="divider-header">
                                <a>Basics</a>
                            </li>
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/01/">
                        
                            <a href="/pages/1/01/" onclick="pageScrollToTop(this)">
                                Computer Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/02/">
                        
                            <a href="/pages/1/02/" onclick="pageScrollToTop(this)">
                                Game Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/03/">
                        
                            <a href="/pages/1/03/" onclick="pageScrollToTop(this)">
                                Hacking Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/04/">
                        
                            <a href="/pages/1/04/" onclick="pageScrollToTop(this)">
                                Setting Up a VM
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/1/05/">
                        
                            <a href="/pages/1/05/" onclick="pageScrollToTop(this)">
                                Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                            <li class="divider-header">
                                <a>Debugging & Reversing</a>
                            </li>
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/01/">
                        
                            <a href="/pages/2/01/" onclick="pageScrollToTop(this)">
                                Debugging Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/02/">
                        
                            <a href="/pages/2/02/" onclick="pageScrollToTop(this)">
                                Assembly Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/03/">
                        
                            <a href="/pages/2/03/" onclick="pageScrollToTop(this)">
                                Using Breakpoints
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/04/">
                        
                            <a href="/pages/2/04/" onclick="pageScrollToTop(this)">
                                Changing Game Code
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/05/">
                        
                            <a href="/pages/2/05/" onclick="pageScrollToTop(this)">
                                Reversing Code
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/06/">
                        
                            <a href="/pages/2/06/" onclick="pageScrollToTop(this)">
                                Code Caves
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/07/">
                        
                            <a href="/pages/2/07/" onclick="pageScrollToTop(this)">
                                Using Code Caves
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/08/">
                        
                            <a href="/pages/2/08/" onclick="pageScrollToTop(this)">
                                Dynamic Memory Allocation
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/2/09/">
                        
                            <a href="/pages/2/09/" onclick="pageScrollToTop(this)">
                                Defeating DMA
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Programming</a>
                            </li>
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/01/">
                        
                            <a href="/pages/3/01/" onclick="pageScrollToTop(this)">
                                Programming Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/02/">
                        
                            <a href="/pages/3/02/" onclick="pageScrollToTop(this)">
                                External Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/03/">
                        
                            <a href="/pages/3/03/" onclick="pageScrollToTop(this)">
                                DLL Memory Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/04/">
                        
                            <a href="/pages/3/04/" onclick="pageScrollToTop(this)">
                                Code Caves &amp; DLL&#39;s
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/3/05/">
                        
                            <a href="/pages/3/05/" onclick="pageScrollToTop(this)">
                                Printing Text
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>RTS/RPG Hacks</a>
                            </li>
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/01/">
                        
                            <a href="/pages/4/01/" onclick="pageScrollToTop(this)">
                                Stathack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/02/">
                        
                            <a href="/pages/4/02/" onclick="pageScrollToTop(this)">
                                Map Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/03/">
                        
                            <a href="/pages/4/03/" onclick="pageScrollToTop(this)">
                                Macro Bot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/4/04/">
                        
                            <a href="/pages/4/04/" onclick="pageScrollToTop(this)">
                                Farming Bot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>FPS Hacks</a>
                            </li>
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/01/">
                        
                            <a href="/pages/5/01/" onclick="pageScrollToTop(this)">
                                3D Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/02/">
                        
                            <a href="/pages/5/02/" onclick="pageScrollToTop(this)">
                                Wallhack (Memory)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/03/">
                        
                            <a href="/pages/5/03/" onclick="pageScrollToTop(this)">
                                Wallhack (OpenGL)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/04/">
                        
                            <a href="/pages/5/04/" onclick="pageScrollToTop(this)">
                                Chams (OpenGL)
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/05/">
                        
                            <a href="/pages/5/05/" onclick="pageScrollToTop(this)">
                                Triggerbot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/06/">
                        
                            <a href="/pages/5/06/" onclick="pageScrollToTop(this)">
                                Aimbot
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/07/">
                        
                            <a href="/pages/5/07/" onclick="pageScrollToTop(this)">
                                No Recoil
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/08/">
                        
                            <a href="/pages/5/08/" onclick="pageScrollToTop(this)">
                                Radar Hack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter active" data-level="1.2" data-path="/pages/5/09/">
                        
                            <a href="/pages/5/09/" onclick="pageScrollToTop(this)">
                                ESP
                            </a>
                            
                                
                                    <ul><li><a href="#target" onclick="mobilePageScrollToAnchor(this)" >Target</a></li><li><a href="#identify" onclick="mobilePageScrollToAnchor(this)" >Identify</a></li><li><a href="#understand" onclick="mobilePageScrollToAnchor(this)" >Understand</a></li><li><a href="#viewports" onclick="mobilePageScrollToAnchor(this)" >Viewports</a></li><li><a href="#world-to-screen" onclick="mobilePageScrollToAnchor(this)" >World to Screen</a></li><li><a href="#scaling-values" onclick="mobilePageScrollToAnchor(this)" >Scaling Values</a></li><li><a href="#locating-print-text" onclick="mobilePageScrollToAnchor(this)" >Locating Print Text</a></li><li><a href="#print-text-code-cave" onclick="mobilePageScrollToAnchor(this)" >Print Text Code Cave</a></li><li><a href="#refining-equation" onclick="mobilePageScrollToAnchor(this)" >Refining Equation</a></li><li><a href="#up-and-down" onclick="mobilePageScrollToAnchor(this)" >Up and Down</a></li><li><a href="#final-adjustments" onclick="mobilePageScrollToAnchor(this)" >Final Adjustments</a></li><li><a href="#enemy-name" onclick="mobilePageScrollToAnchor(this)" >Enemy Name</a></li><li><a href="#multiple-enemies" onclick="mobilePageScrollToAnchor(this)" >Multiple Enemies</a></li></ul>

                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/5/10/">
                        
                            <a href="/pages/5/10/" onclick="pageScrollToTop(this)">
                                Multihack
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Multiplayer</a>
                            </li>
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/01/">
                        
                            <a href="/pages/6/01/" onclick="pageScrollToTop(this)">
                                Multiplayer Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/02/">
                        
                            <a href="/pages/6/02/" onclick="pageScrollToTop(this)">
                                Packet Analysis
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/03/">
                        
                            <a href="/pages/6/03/" onclick="pageScrollToTop(this)">
                                Reversing Packets
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/04/">
                        
                            <a href="/pages/6/04/" onclick="pageScrollToTop(this)">
                                Creating an External Client
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/6/05/">
                        
                            <a href="/pages/6/05/" onclick="pageScrollToTop(this)">
                                Proxying TCP Traffic
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Tool Development</a>
                            </li>
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/01/">
                        
                            <a href="/pages/7/01/" onclick="pageScrollToTop(this)">
                                DLL Injector
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/02/">
                        
                            <a href="/pages/7/02/" onclick="pageScrollToTop(this)">
                                Pattern Scanner
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/03/">
                        
                            <a href="/pages/7/03/" onclick="pageScrollToTop(this)">
                                Memory Scanner
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/04/">
                        
                            <a href="/pages/7/04/" onclick="pageScrollToTop(this)">
                                Disassembler
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/05/">
                        
                            <a href="/pages/7/05/" onclick="pageScrollToTop(this)">
                                Debugger
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/7/06/">
                        
                            <a href="/pages/7/06/" onclick="pageScrollToTop(this)">
                                Call Logger
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                            <li class="divider-header">
                                <a>Game Resources</a>
                            </li>
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/01/">
                        
                            <a href="/pages/8/01/" onclick="pageScrollToTop(this)">
                                Resource Fundamentals
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/02/">
                        
                            <a href="/pages/8/02/" onclick="pageScrollToTop(this)">
                                Modifying Save Data
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/03/">
                        
                            <a href="/pages/8/03/" onclick="pageScrollToTop(this)">
                                Modifying Textures
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/pages/8/04/">
                        
                            <a href="/pages/8/04/" onclick="pageScrollToTop(this)">
                                Modifying Units
                            </a>
                            
                                
                            
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    
                
            
                <!-- <p>posts</p> -->
                
                    

                    
                
            
        </ul>

        &nbsp;
    </nav>
</div>
<div class="book-body">
        <div class="book-header" role="navigation">
          <!-- Title -->
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
            <a href=".">ESP</a>
            
          </h1>
        </div>

        <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    

                    <h1 id="target">Target</h1>

<p>Our target for this lesson will be Assault Cube 1.2.0.2.</p>

<h1 id="identify">Identify</h1>

<p>Our goal in this lesson is to create an ESP hack, a type of hack that
displays player information above their heads. This information includes
the player’s health, name, or current weapon in use, and it is also
displayed through walls.</p>

<h1 id="understand">Understand</h1>

<p>In the <a href="/pages/5/06/">Aimbot</a> lesson, we created an aimbot, which
worked by calculating the angle between our player and an enemy and then
setting our player’s current view angle to that calculated angle. For
games where a camera is always bound to our player’s view, such as an FPS,
we can use these same angles to create an ESP.</p>

<p>Instead of setting our player’s view angle, we will use the difference in
these angles to convert the enemy’s 3D location in the world to a 2D
position relative to our player’s view. We will then draw text at this
position.</p>

<p>The method discussed in this lesson has several drawbacks, but it
demonstrates the basic concepts used in an ESP. A more accurate approach
is to use the game’s viewmatrix.</p>

<h1 id="viewports">Viewports</h1>

<p>Take the following scene from Assault Cube:</p>

<p><img src="/assets/images/5/9/cube1.png" alt="Assault Cube Gameplay" /></p>

<p>We know from the previous lesson that the enemy we see in the scene above has
a 3D position in the world represented by X, Y, and Z coordinates.
However, when we are playing Assault Cube, the game needs to display this
enemy on a monitor, which is two-dimensional. To do this, the game will
choose a static view of the world, called a viewport. In this case, the
viewport is tied to the player model that we are controlling. The game
will then use this viewport to determine where 3D objects in the world
should be displayed.</p>

<p>A good way to visualize a viewport is to imagine a movie set. When filming
a movie, the set has actors, sound fixtures, lighting fixtures, and people
and fixtures responsible for practical effects. However, none of this
extra information is shown when you watch the movie, as the only view of
this 3D world (the set) that you can access is the camera filming a
specific section. In this analogy, the camera is acting as your viewport
into the movie set’s 3D world.</p>

<p>By moving around in the world, we are adjusting our viewport’s position.
For example, by moving to the right of the position shown in the scene
above, we have the following scene:</p>

<p><img src="/assets/images/5/9/cube2.png" alt="Assault Cube Gameplay" /></p>

<p>We can see that the enemy has not moved, but his model is now being
displayed on the left side of our screen. This is because when we moved
our player, we also moved our viewport into this world to a different
position.</p>

<h1 id="world-to-screen">World to Screen</h1>

<p>Like we did when developing our aimbot, we will simplify our ESP
development by first isolating the X (or left and right) value. After we
have figured out how to calculate this value, we can add our Y (up and
down value). We will also develop our hack for a single enemy and then add
support for multiple enemies.</p>

<p>In this lesson, we will assume that you are running Assault Cube in a window
of 1024x768. This means that our window is 1024 pixels wide and 768 pixels
high. Depending on where your viewport is in the world, the enemy will
appear at certain pixel values when the scene is rendered. For example,
take the following scene where we are looking at the enemy:</p>

<p><img src="/assets/images/5/9/cube3.png" alt="Assault Cube Gameplay" /></p>

<p>In this case, the enemy is in the middle of our screen, or 1024 / 2. This
means that the enemy is at (roughly) the 512th pixel. When we move our
player left, the enemy will now appear on the far right of our screen:</p>

<p><img src="/assets/images/5/9/cube4.png" alt="Assault Cube Gameplay" /></p>

<p>It is hard to identify the exact pixel that the enemy is at here, but we
can assume it is roughly 1000. Likewise, if we move right, the enemy will
appear on the far left of our screen:</p>

<p><img src="/assets/images/5/9/cube2.png" alt="Assault Cube Gameplay" /></p>

<p>Here the enemy starts at roughly 100 pixels.</p>

<p>We can represent these different scenarios in a series of equations. Since
the default view has the middle of our viewport lining up to the middle of
our screen, we want to find a value S such that all these equations below
will be satisfied:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="n">S</span>
<span class="mi">100</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="n">S</span>
<span class="mi">1000</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="n">S</span>
</code></pre></div></div>

<p>There is no constant value of S that will make all these equations true.
We need a way for S to be both negative and positive and represent values
from roughly -400 to 0 to 400. To achieve this, we can expand S out into a
multiplication of two values, as shown below:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>
<span class="mi">100</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>
<span class="mi">1000</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>
</code></pre></div></div>

<p>In these equations, A will be tied to how far the enemy is from our
viewport’s center, and F will be a static scaling value. If we are looking
directly at the enemy, A will be 0, making our first equation true. If we
are looking to the right of the enemy, (A * F) will produce a negative
value to subtract from 512. Likewise, if we are looking to the left, (A *
F) will produce a positive value to add to 512.</p>

<h1 id="scaling-values">Scaling Values</h1>

<p>Next, we need to determine the values of A and F. When writing our aimbot,
we determined our current player’s yaw as well as the yaw needed to aim at
an enemy. In that case, we then set our current player’s yaw to the latter
yaw. However, for this hack, we can use the difference between these
values as a value for A above. The larger the difference between these
values is, the farther away the enemy is from the center of our screen.</p>

<p>We can use our aimbot code to determine what these values look like in the
game. In our aimbot code, we calculated the yaw via:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">abspos_x</span> <span class="o">=</span> <span class="n">enemy</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">-</span> <span class="n">player</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">abspos_y</span> <span class="o">=</span> <span class="n">enemy</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">-</span> <span class="n">player</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">azimuth_xy</span> <span class="o">=</span> <span class="n">atan2f</span><span class="p">(</span><span class="n">abspos_y</span><span class="p">,</span> <span class="n">abspos_x</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">yaw</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">azimuth_xy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">M_PI</span><span class="p">));</span>
<span class="n">yaw</span> <span class="o">+=</span> <span class="mi">90</span><span class="p">;</span>
</code></pre></div></div>

<p>Unlike in the aimbot, where we set <strong>player-&gt;yaw = yaw</strong>, we
will instead calculate the difference between these yaws:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">yaw_dif</span> <span class="o">=</span> <span class="n">player</span><span class="o">-&gt;</span><span class="n">yaw</span> <span class="o">-</span> <span class="n">yaw</span><span class="p">;</span>
</code></pre></div></div>

<p>We can use Visual Studio’s built-in debugger to see what this value is.
First, build your DLL as normal. Then, open up Assault Cube, create a
two-player game just like we did in the <a href="/pages/5/06/">Aimbot</a> lesson, and inject the DLL with a DLL
injector. With our DLL injected, go into Visual Studio and choose
<em>Debug</em> -&gt; <em>Attach to Process</em>:</p>

<p><img src="/assets/images/5/9/vs1.png" alt="VS Remote Debugging" /></p>

<p>Next, choose the Assault Cube process, <em>ac_client</em>:</p>

<p><img src="/assets/images/5/9/vs2.png" alt="VS Remote Debugging" /></p>

<p>With this done, you can set breakpoints on your DLL code in an identical
manner to how we did previously for regular executable code. If you put a
breakpoint on the line assigning <strong>yaw_dif</strong>, you can see its
value in the <em>Autos</em> window at the bottom of Visual Studio:</p>

<p><img src="/assets/images/5/9/vs3.png" alt="VS Remote Debugging" /></p>

<p>With this set up, we can now get our <strong>yaw_dif</strong> values.
Repeat the same scenarios that we discussed above (looking at, far left,
and far right) and get the corresponding <strong>yaw_dif</strong> values
for each:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Looking</span> <span class="n">at</span> <span class="n">enemy</span><span class="o">:</span>
  <span class="n">yaw_dif</span>	<span class="o">-</span><span class="mf">0.307769775</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">left</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="n">yaw_dif</span>	<span class="mf">34.9015427</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">right</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="n">yaw_dif</span>	<span class="o">-</span><span class="mf">39.5185280</span>
</code></pre></div></div>

<p>Depending on where you stand in the map, your values may be different. For
the sake of this lesson, we will use the values above for our equations.
Let’s plug these values into our equations as the value for A:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Looking</span> <span class="n">at</span> <span class="n">enemy</span><span class="o">:</span>
  <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.307769775</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">left</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="o">&lt;</span><span class="mi">100</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="mf">34.9015427</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">right</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="o">&gt;</span><span class="mi">950</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">39.5185280</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>
</code></pre></div></div>

<p>Since we are roughly estimating, we will round these values to the closest
whole number:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Looking</span> <span class="n">at</span> <span class="n">enemy</span><span class="o">:</span>
  <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">left</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="mi">100</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="mi">35</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">right</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="mi">1000</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">40</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>
</code></pre></div></div>

<p>We can see that <strong>yaw_dif</strong> will satisfy our first equation
regardless of the value we choose for F. Using some basic algebra, we can
solve for F using the far left and far right equations:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">left</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">11.771428571</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">right</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">12.2</span>
</code></pre></div></div>

<p>Since these were approximations, we will take the loose average and choose
-12 as our value for F. Our initial equation to convert an enemy’s
position to a 2D screen coordinate for the X dimension is:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">screen_x</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">+</span> <span class="p">(</span><span class="n">yaw_dif</span> <span class="o">*</span> <span class="o">-</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div></div>

<p>We will have to make adjustments to this equation, but it gives us a good
starting point.</p>

<h1 id="locating-print-text">Locating Print Text</h1>

<p>To continue testing our equation, we need to find a way to print text on
the screen. We talked about how to find and hook a text printing function
in the <a href="/pages/3/05/">Printing Text</a> lesson. We will use a similar
approach here.</p>

<p>We want to identify some text that looks like it can be easily displayed
anywhere on the screen. After investigating some of the documentation, we
can determine that the <em>showspeed</em> command text is a good candidate,
as it displays in the exact middle of the screen:</p>

<p><img src="/assets/images/5/9/cube5.png" alt="Speed Text" /></p>

<p>Since this text is static, we can search for its pattern in x64dbg and
find where it resides in memory. Attach x64dbg to Assault Cube, then
navigate to the <em>Memory Map</em> tab and right-click. Choose
<em>Find Pattern</em>:</p>

<p><img src="/assets/images/5/9/cube6.png" alt="Assault Cube Memory Map" /></p>

<p>This will allow us to search all the active memory in the game for
whatever pattern of bytes we specify. In this case, we will search for the
start of this text, <em>Speed:</em>:</p>

<p><img src="/assets/images/5/9/cube7.png" alt="Finding a Pattern" /></p>

<p>The search should find a single pattern:</p>

<p><img src="/assets/images/5/9/cube8.png" alt="Finding a Pattern" /></p>

<p>Double-click on it to show the address in the dump. Next, we want to see
where this memory address is referenced in code. Select the first letter
and right-click. Choose <em>Find references</em>:</p>

<p><img src="/assets/images/5/9/cube9.png" alt="Finding References to a Pattern" /></p>

<p>This will return a single reference, or place where this address was
referenced by the code of the game:</p>

<p><img src="/assets/images/5/9/cube10.png" alt="Finding References to a Pattern" /></p>

<p>Double-click again on this reference to be brought to the code responsible
for accessing this memory:</p>

<p><img src="/assets/images/5/9/cube11.png" alt="Finding References to a Pattern" /></p>

<p>Quickly analyzing this code, we see that we move a text string into
<strong>ecx</strong> (in this case, our <em>Speed:</em> string) and then
push two values on the stack before calling <code class="language-plaintext highlighter-rouge">0x419880</code>. We can
see one value is <code class="language-plaintext highlighter-rouge">0x708</code>, or 1800 decimal. If we set a
breakpoint on the <strong>call</strong>, we can see the value of
<strong>eax</strong>:</p>

<p><img src="/assets/images/5/9/cube12.png" alt="Print Text Function" /></p>

<p><code class="language-plaintext highlighter-rouge">0x4B0</code>, or 1200, and 1800 seem like reasonable X and Y values.
Combined with a text string in <strong>ecx</strong>, this function is most
likely responsible for printing the <em>Speed:</em> text. We can verify
this behavior by modifying the <strong>push 0x708</strong> to another
value, like <strong>push 0x100</strong>:</p>

<p><img src="/assets/images/5/9/cube13.png" alt="Print Text Function" /></p>

<p>Upon doing this, our <em>Speed:</em> text will appear near the top of the
screen:</p>

<p><img src="/assets/images/5/9/cube14.png" alt="Print Text Function" /></p>

<p>From this, we can see that the method responsible for printing text
expects Y to be pushed first, followed by X.</p>

<h1 id="print-text-code-cave">Print Text Code Cave</h1>

<p>To nail down our equation, we will use a code cave that will modify the
<em>showspeed</em> print text call to draw our enemy text. We will hook at
the first <strong>push</strong> so we can push our desired values on the
stack:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BOOL</span> <span class="n">WINAPI</span> <span class="nf">DllMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hinstDLL</span><span class="p">,</span> <span class="n">DWORD</span> <span class="n">fdwReason</span><span class="p">,</span> <span class="n">LPVOID</span> <span class="n">lpvReserved</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">DWORD</span> <span class="n">old_protect</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">hook_location</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mh">0x0040BE78</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">fdwReason</span> <span class="o">==</span> <span class="n">DLL_PROCESS_ATTACH</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPTHREAD_START_ROUTINE</span><span class="p">)</span><span class="n">injected_thread</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">VirtualProtect</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">hook_location</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">PAGE_EXECUTE_READWRITE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_protect</span><span class="p">);</span>
    <span class="o">*</span><span class="n">hook_location</span> <span class="o">=</span> <span class="mh">0xE9</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">DWORD</span><span class="o">*</span><span class="p">)(</span><span class="n">hook_location</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="o">&amp;</span><span class="n">codecave</span> <span class="o">-</span> <span class="p">((</span><span class="n">DWORD</span><span class="p">)</span><span class="n">hook_location</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span>
    <span class="o">*</span><span class="p">(</span><span class="n">hook_location</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x90</span><span class="p">;</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>Our code cave itself will push our currently assigned X and Y values on
the stack, as well as move some generic <strong>Enemy</strong> text into
<strong>ecx</strong>. After we do this, we will jump back to the original
call to have it print out our text:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DWORD</span> <span class="n">ret_address</span> <span class="o">=</span> <span class="mh">0x0040BE7E</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Enemy"</span><span class="p">;</span>

<span class="n">DWORD</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">DWORD</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kr">__declspec</span><span class="p">(</span><span class="kr">naked</span><span class="p">)</span> <span class="kt">void</span> <span class="nf">codecave</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">__asm</span> <span class="p">{</span>
    <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span> <span class="n">text</span>
    <span class="n">push</span> <span class="n">y</span>
    <span class="n">push</span> <span class="n">x</span>
    <span class="n">jmp</span> <span class="n">ret_address</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can verify that this code is working by setting our X and Y to
<code class="language-plaintext highlighter-rouge">0x100</code> in our thread, after we calculate the
<strong>yaw_dif</strong>:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="n">y</span> <span class="o">=</span> <span class="mh">0x100</span><span class="p">;</span>
</code></pre></div></div>

<p>If we go into a game and show the speed, you will see our text appearing
in the upper-left corner of the screen:</p>

<p><img src="/assets/images/5/9/cube15.png" alt="Print Text Function" /></p>

<p>For now, we can use this to nail down our ESP. We will come back later and
adjust this approach so that we can write multiple text strings for
multiple players.</p>

<h1 id="refining-equation">Refining Equation</h1>

<p>With a text function, we can now start working on the ESP. However, we
first need to adjust our equations. When we initially modeled the screen,
we assumed that center would be 512. However, from the speed function, we
saw that center was <code class="language-plaintext highlighter-rouge">0x4B0</code>, or 1200. Games will often make use
of a “virtual” screen that will always be an identical size regardless of
the resolution. That way, developers only have to convert the resolution
into the virtual screen size once, but they can use consistent coordinates
in the rest of the code.</p>

<p>In this case, it looks like the game’s virtual screen is 2400x1800. We can
go back to our original equations and update them with these new numbers:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Looking</span> <span class="n">at</span> <span class="n">enemy</span><span class="o">:</span>
  <span class="mi">1200</span> <span class="o">=</span> <span class="mi">1200</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">left</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="mi">100</span> <span class="o">=</span> <span class="mi">1200</span> <span class="o">+</span> <span class="p">(</span><span class="mi">35</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">right</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="mi">2400</span> <span class="o">=</span> <span class="mi">1200</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">40</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>
</code></pre></div></div>

<p>Calculating with these new values, we will get a different value for F:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">left</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">31.428571429</span>

<span class="n">Enemy</span> <span class="n">on</span> <span class="n">far</span> <span class="n">right</span> <span class="n">of</span> <span class="n">screen</span><span class="o">:</span>
  <span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span>
</code></pre></div></div>

<p>Since these are again approximations, we will choose a value of -30 as our
value for F, making our new equation:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">screen_x</span> <span class="o">=</span> <span class="mi">1200</span> <span class="o">+</span> <span class="p">(</span><span class="n">yaw_dif</span> <span class="o">*</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div></div>
<p>We can implement this equation in our main thread like so:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">yaw_dif</span> <span class="o">=</span> <span class="n">player</span><span class="o">-&gt;</span><span class="n">yaw</span> <span class="o">-</span> <span class="n">yaw</span><span class="p">;</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)(</span><span class="mi">1200</span> <span class="o">+</span> <span class="p">(</span><span class="n">yaw_dif</span> <span class="o">*</span> <span class="o">-</span><span class="mi">30</span><span class="p">));</span>
<span class="n">y</span> <span class="o">=</span> <span class="mh">0x200</span><span class="p">;</span>
</code></pre></div></div>

<p>If you go into a game, the <em>Enemy</em> text will appear on the same X
axis as the enemy from certain angles, as we expect:</p>

<p><img src="/assets/images/5/9/cube16.png" alt="Basic ESP" /></p>

<p>However, depending on what angle we are looking at, the text will appear
far off to the side:</p>

<p><img src="/assets/images/5/9/cube17.png" alt="Basic ESP" /></p>

<p>If we attach a debugger, we can see that when the text is not correct, the
<strong>yaw_dif</strong> value is over 180:</p>

<p><img src="/assets/images/5/9/cube18.png" alt="Basic ESP" /></p>

<p>Just as a contrast, we can see that correct text values always have a
<strong>yaw_dif</strong> value under 180:</p>

<p><img src="/assets/images/5/9/cube19.png" alt="Basic ESP" /></p>

<p>This situation appears to occur when our player’s yaw and the calculated
yaw for the enemy are between 275 and 360/0. When subtracting to get our
difference, the equations produce artificially high values that do not
work with our scaling factor. For example, if our yaw difference is 5, our
text will be correctly displayed. Likewise, if our difference is -5, the
text will be displayed correctly in the opposite direction. However, if
our difference is -355, the text will be displayed incorrectly, as the
equation’s result will now be 11,850, causing the text to wrap over to the
other side of the screen.</p>

<p>Regardless of the viewport we choose, our viewport can never show more
than 180 degrees of the screen. Any more would result in us seeing behind
our player.</p>

<p><img src="/assets/images/5/9/diagram1.png" alt="Viewport" /></p>

<p>To fix the case of -355 that we described above, we can subtract (or add,
in the case of negative) 360:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">yaw_dif</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span>
  <span class="n">yaw_dif</span> <span class="o">=</span> <span class="n">yaw_dif</span> <span class="o">-</span> <span class="mi">360</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">yaw_dif</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">)</span> 
  <span class="n">yaw_dif</span> <span class="o">=</span> <span class="n">yaw_dif</span> <span class="o">+</span> <span class="mi">360</span><span class="p">;</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)(</span><span class="mi">1200</span> <span class="o">+</span> <span class="p">(</span><span class="n">yaw_dif</span> <span class="o">*</span> <span class="o">-</span><span class="mi">30</span><span class="p">));</span>
</code></pre></div></div>

<p>With this in place, our text will always correctly display, regardless of
the angle.</p>

<h1 id="up-and-down">Up and Down</h1>

<p>To calculate the Y dimension for our aimbot, we had the following code:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">abspos_z</span> <span class="o">=</span> <span class="n">enemy</span><span class="o">-&gt;</span><span class="n">z</span> <span class="o">-</span> <span class="n">player</span><span class="o">-&gt;</span><span class="n">z</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">abspos_y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">abspos_y</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">abspos_y</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">abspos_x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">abspos_x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">abspos_y</span> <span class="o">=</span> <span class="n">abspos_x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">float</span> <span class="n">azimuth_z</span> <span class="o">=</span> <span class="n">atan2f</span><span class="p">(</span><span class="n">abspos_z</span><span class="p">,</span> <span class="n">abspos_y</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">azimuth_z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">M_PI</span><span class="p">));</span>

</code></pre></div></div>

<p>We can use the same approach as above to calculate our Y dimension. We
learned from the speed function that <code class="language-plaintext highlighter-rouge">0x708</code>, or 1800, was the
bottom of the virtual screen. We can perform the same series of equations
as above to get the scaling factor for Y:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">looking</span> <span class="n">above</span> <span class="n">the</span> <span class="n">enemy</span> <span class="p">(</span><span class="n">enemy</span> <span class="n">at</span> <span class="mi">1800</span><span class="p">)</span>
  <span class="n">pitch_dif</span>	<span class="mf">25.4983654</span>	
  <span class="n">F</span> <span class="o">=</span> <span class="mf">35.4</span>
<span class="n">looking</span> <span class="n">at</span> <span class="n">enemy</span><span class="p">,</span> <span class="mi">1800</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">pitch_dif</span>	<span class="o">-</span><span class="mf">4.36527729</span>	
  <span class="n">F</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">looking</span> <span class="n">below</span> <span class="n">the</span> <span class="n">enemy</span> <span class="p">(</span><span class="n">enemy</span> <span class="n">at</span> <span class="mi">100</span><span class="p">)</span>
  <span class="n">pitch_dif</span>	<span class="o">-</span><span class="mf">41.1258888</span>	
  <span class="n">F</span> <span class="o">=</span> <span class="mf">19.464720195</span>
</code></pre></div></div>

<p>From these values, we will choose a value of 25 as our scaling factor:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">pitch_dif</span> <span class="o">=</span> <span class="n">player</span><span class="o">-&gt;</span><span class="n">pitch</span> <span class="o">-</span> <span class="n">pitch</span><span class="p">;</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)(</span><span class="mi">900</span> <span class="o">+</span> <span class="p">((</span><span class="n">pitch_dif</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span><span class="p">));</span>
</code></pre></div></div>

<p>With this in place, text will now correctly display in the Y axis:</p>

<p><img src="/assets/images/5/9/cube20.png" alt="Basic ESP" /></p>

<h1 id="final-adjustments">Final Adjustments</h1>

<p>Right now, our text will always display, even if the enemy is behind us.
To prevent this, we will add a check into our print text code cave. In
this check, we will set our string to empty if the enemy is not visible in
our viewport:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">__declspec</span><span class="p">(</span><span class="kr">naked</span><span class="p">)</span> <span class="kt">void</span> <span class="nf">codecave</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">2400</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">1800</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">"Enemy"</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>We can also resolve the issue of text always appearing slightly to the
left of the enemy. For this, we will simply always add 200 to whatever X
value we calculated:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="p">{</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s">"Enemy"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">x</span> <span class="o">+=</span> <span class="mi">200</span><span class="p">;</span>
</code></pre></div></div>

<p>Our text is now displaying correctly for a single enemy.</p>

<p><img src="/assets/images/5/9/cube21.png" alt="Basic ESP" /></p>

<h1 id="enemy-name">Enemy Name</h1>

<p>With our coordinates nailed down, we can work on getting the enemy’s name
to display above their head. Like before, we can find the player’s name in
the game’s Player structure and add it to our code’s Player structure.
Looking at the player structure in memory, we see the player’s name a bit
after the yaw element we identified before:</p>

<p><img src="/assets/images/5/9/cube22.png" alt="Player Structure" /></p>

<p>If we try to change our own player’s name, we find that this can be a
maximum of 16 characters. Subtracting the offset from our yaw value, we
can create padding with an unknown element, like we did in the <a href="/pages/5/06/">Aimbot</a> lesson. Our player structure with the name
now looks like:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Player</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">unknown1</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="kt">float</span> <span class="n">x</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">y</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">z</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">unknown2</span><span class="p">[</span><span class="mh">0x30</span><span class="p">];</span>
  <span class="kt">float</span> <span class="n">yaw</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">pitch</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">unknown3</span><span class="p">[</span><span class="mh">0x1DD</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div></div>

<p>We can now modify our code to use this enemy name instead of the generic
<strong>Enemy</strong> text. First, remove the
<strong>else</strong> condition in the code cave which set the text to
<strong>Enemy</strong>:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
<span class="p">...</span>
<span class="kr">__declspec</span><span class="p">(</span><span class="kr">naked</span><span class="p">)</span> <span class="kt">void</span> <span class="nf">codecave</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">2400</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">1800</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">x</span> <span class="o">+=</span> <span class="mi">200</span><span class="p">;</span>
  <span class="p">...</span>
</code></pre></div></div>

<p>Next, after we calculate our X and Y, we want to set the text member to
the enemy’s name by assigning the pointer:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span> <span class="o">=</span> <span class="n">enemy</span><span class="o">-&gt;</span><span class="n">name</span>
</code></pre></div></div>

<p>With this change, enemy names will now appear above their head:</p>

<p><img src="/assets/images/5/9/cube23.png" alt="ESP with Name" /></p>

<p>In this lesson, we will only display the enemy’s name. A similar approach can
be used to display the enemy’s weapon, health, and other information.</p>

<h1 id="multiple-enemies">Multiple Enemies</h1>

<p>Now that we have a working ESP for a single enemy, we can expand it to
include multiple enemies. Like we did when creating our aimbot, we can use
the same code we nailed down above and include it in a loop.</p>

<p>First, instead of one X, Y, and name value, we will create an array. The
maximum amount of players in an Assault Cube game is 32, so we will use
this as the size of our array. For our loops, we will use the current
number of players we identified previously, so any extra array elements
will not cause an issue. Since we will need to use this current player
element in both our calculation loop and draw loop, we will create a
global variable for it as well:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define MAX_PLAYERS 32
</span>
<span class="n">DWORD</span> <span class="n">x_values</span><span class="p">[</span><span class="n">MAX_PLAYERS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
<span class="n">DWORD</span> <span class="n">y_values</span><span class="p">[</span><span class="n">MAX_PLAYERS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
<span class="kt">char</span><span class="o">*</span> <span class="n">names</span><span class="p">[</span><span class="n">MAX_PLAYERS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">NULL</span> <span class="p">};</span>

<span class="kt">int</span><span class="o">*</span> <span class="n">current_players</span><span class="p">;</span>
</code></pre></div></div>

<p>Next, we will modify our thread to iterate over all enemies in an
identical manner to the aimbot. When we calculate the X and Y values, we
will store these values in an array instead of a single element:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">current_players</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)(</span><span class="mh">0x50F500</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">current_players</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">DWORD</span><span class="o">*</span> <span class="n">enemy_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="o">*</span><span class="p">)(</span><span class="mh">0x50F4F8</span><span class="p">);</span>
  <span class="n">DWORD</span><span class="o">*</span> <span class="n">enemy_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="n">enemy_list</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>

  <span class="p">...</span>
  <span class="n">x_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)(</span><span class="mi">1200</span> <span class="o">+</span> <span class="p">(</span><span class="n">yaw_dif</span> <span class="o">*</span> <span class="o">-</span><span class="mi">30</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="n">y_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)(</span><span class="n">center_y</span> <span class="o">+</span> <span class="p">((</span><span class="n">pitch_dif</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">enemy</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
</code></pre></div></div>

<p>Finally, we need to redo our text printing function so that we can print
multiple enemy names. We will use the same location, but instead of
replacing the pushed parameters, we will hook the call itself. In our code
cave, we will replace the call with empty text, and then create a loop to
call the print text function several times.</p>

<p>First, we will change our hook location to hook the call:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">hook_location</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mh">0x0040BE7E</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">fdwReason</span> <span class="o">==</span> <span class="n">DLL_PROCESS_ATTACH</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPTHREAD_START_ROUTINE</span><span class="p">)</span><span class="n">injected_thread</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">VirtualProtect</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">hook_location</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">PAGE_EXECUTE_READWRITE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_protect</span><span class="p">);</span>
  <span class="o">*</span><span class="n">hook_location</span> <span class="o">=</span> <span class="mh">0xE9</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">DWORD</span><span class="o">*</span><span class="p">)(</span><span class="n">hook_location</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="o">&amp;</span><span class="n">codecave</span> <span class="o">-</span> <span class="p">((</span><span class="n">DWORD</span><span class="p">)</span><span class="n">hook_location</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can then delete our previous code cave and create a new one. In it, we
will first replace <strong>ecx</strong> with empty text, then call the
print text function, and then save and restore everything as we have done
before:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DWORD</span> <span class="n">ret_address</span> <span class="o">=</span> <span class="mh">0x0040BE83</span><span class="p">;</span>
<span class="n">DWORD</span> <span class="n">text_address</span> <span class="o">=</span> <span class="mh">0x419880</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">empty_text</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>

<span class="kr">__declspec</span><span class="p">(</span><span class="kr">naked</span><span class="p">)</span> <span class="kt">void</span> <span class="nf">codecave</span><span class="p">()</span> <span class="p">{</span>

  <span class="kr">__asm</span> <span class="p">{</span>
    <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span> <span class="n">empty_text</span>
    <span class="n">call</span> <span class="n">text_address</span>
    <span class="n">pushad</span>
  <span class="p">}</span>

  <span class="c1">//loop</span>

  <span class="kr">__asm</span> <span class="p">{</span>
    <span class="n">popad</span>
    <span class="n">jmp</span> <span class="n">ret_address</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To call the print text function by ourselves, we need to figure out how to
fix the stack. Remember the code we found:</p>

<p><img src="/assets/images/5/9/cube24.png" alt="Print Text Function" /></p>

<p>When you see <strong>add esp</strong> or <strong>sub esp</strong> after a
call, it means the called code expects you to balance the stack. The
easiest way to determine how to balance the stack is to find the smallest
value of <strong>esp</strong> being modified and use that call as a basis.
This can be done by entering the print text call and finding the
references:</p>

<p><img src="/assets/images/5/9/cube25.png" alt="Print Text Function" /></p>

<p>After going through several of these references, you should find the
following reference, which shows that <strong>add esp, 8</strong> is the
lowest required value to balance the stack:</p>

<p><img src="/assets/images/5/9/cube26.png" alt="Print Text Function" /></p>

<p>With this information, we can invoke the print text call ourselves. First,
we will create a loop that will iterate over all the current players in
the game:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">current_players</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)(</span><span class="mh">0x50F500</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">current_players</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</code></pre></div></div>

<p>To make our array of values easy to use inside the
<strong>asm</strong> block, we will copy the current value into temporary
variables:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>

<span class="n">DWORD</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">DWORD</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">for</span> <span class="p">...</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x_values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">y_values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</code></pre></div></div>

<p>Like before, we will then check the values to make sure that they can be
displayed on screen:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">2400</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">1800</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finally, we will move the enemy’s name into <strong>ecx</strong>, push our
X and Y values, and call the print text function. After that, we will
balance the stack:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">__asm</span> <span class="p">{</span>
  <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span> <span class="n">text</span>
  <span class="n">push</span> <span class="n">y</span>
  <span class="n">push</span> <span class="n">x</span>
  <span class="n">call</span> <span class="n">text_address</span>
  <span class="n">add</span> <span class="n">esp</span><span class="p">,</span> <span class="mi">8</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this in place, we now have all the parts we need to handle multiple
enemies. If you build and inject the DLL into Assault Cube, you will see
multiple enemy names appearing above their heads:</p>

<video controls="" autoplay="" loop="">
  <source src="/assets/images/5/9/cube.mp4" />
</video>

<p>The full code is available for reference on <a href="https://github.com/GameHackingAcademy/AssaultCube_ESP/">github.</a></p>

<p> </p>


                </section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
    </div>
</div>

<!-- introduce mathjax support -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script
  type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


<!-- introduce per-page mermaid support -->


          <a
            href="/pages/5/08/"
            class="navigation navigation-prev navigation-unique"
            aria-label="Previous page: Radar Hack"
          >
            <i class="fa fa-angle-left"></i>
          </a>
           
          <a
            href="/pages/5/10/"
            class="navigation navigation-next navigation-unique"
            aria-label="Next page: Multihack"
          >
            <i class="fa fa-angle-right"></i>
          </a>
          
        </div>
      </div>

      <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "Multihack",
            "level": "1.2",
            "depth": 1,
            "path": "_pages/5/10.md",
            "ref": "_pages/5/10.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "facebook": false,

                "google": false,

                "github": true,
                "github_link": "https://github.com/GameHackingAcademy",

                "telegram": false,
                "telegram_link": "https://t.me",

                "instapaper": false,

                "twitter": true,
                "twitter_link": "https://twitter.com/GameHackingAcad",

                "vk": false,

                "weibo": false
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Game Hacking Academy",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_pages/5/09.md",
        "mtime": "2023-12-25 00:00:00 -0600",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2023-12-26 18:36:09 -0600"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
        });
      </script>
    </div><script src="/assets/gitbook/gitbook.js"></script>
<script src="/assets/gitbook/theme.js"></script>

<script src="/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> -->

<script src="/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
<script src="/assets/gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>

<!-- trackers --><!-- google analytics --><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160704775-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160704775-1');
</script>
<script>
      particlesJS("particles-js", {
        particles: {
          number: {
            value: 20,
            density: {
              enable: true,
              value_area: 100,
            },
          },
          color: {
            value: "#6195b9",
          },
          shape: {
            type: "edge",
          },
          opacity: {
            value: 0.3,
            anim: {
              enable: true,
              speed: 0.1,
              opacity_min: 0,
              sync: false,
            },
          },
          size: {
            value: 15,
            random: true,
          },
          line_linked: {
            enable: false,
          },
          move: {
            enable: true,
            speed: 0.5,
            direction: "top",
            random: true,
            straight: true,
            out_mode: "out",
            bounce: false,
            attract: {
              enable: false,
            },
          },
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: {
              enable: false,
            },
            onclick: {
              enable: false,
            },
            resize: true,
          },
        },
      });
    </script>
  </body>
</html>
